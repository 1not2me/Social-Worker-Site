{% extends "base.html" %}
{% block title %}ניתוחים סטטיסטיים למרצים{% endblock %}

{% block content %}
<section class="page-wrap">
  <h1>ניתוחים סטטיסטיים</h1>
  <p class="subtitle">העלו את קובץ ה-CSV/XLSX של תוצאות השיבוץ.</p>

  <form method="post" enctype="multipart/form-data" class="upload-form">
    <div class="field">
      <label>קובץ תוצאות שיבוץ (CSV/XLSX)</label>
      <input type="file" name="results_file" required>
    </div>
    <div class="btn-wrap">
      <button class="btn-primary" type="submit">נתח קובץ</button>
    </div>
  </form>

  {% if error %}<div class="flash error">{{ error }}</div>{% endif %}

  {% if tables %}
    <!-- הטבלאות והקנבסים כפי שכבר כתבת -->
    <section class="card"> ... </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const charts = {{ charts|tojson }};
      const ctx1 = document.getElementById('chartSites'); new Chart(ctx1,{type:'bar',data:{labels:charts.site_labels,datasets:[{label:'מספר סטודנטים',data:charts.site_values}]},options:{responsive:true}});
      const ctx2 = document.getElementById('chartFields'); new Chart(ctx2,{type:'bar',data:{labels:charts.field_labels,datasets:[{label:'מספר סטודנטים',data:charts.field_values}]},options:{responsive:true}});
      if (charts.avg_labels && charts.avg_labels.length){
        const ctx3 = document.getElementById('chartAvg'); new Chart(ctx3,{type:'line',data:{labels:charts.avg_labels,datasets:[{label:'ממוצע התאמה',data:charts.avg_values}]},options:{responsive:true}});
      }
    </script>
  {% endif %}
</section>
{% endblock %}
